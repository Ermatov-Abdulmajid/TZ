"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[948],{43061:function(e,t,r){r.r(t),r.d(t,{default:function(){return ne}});var n=r(50959),i=r(21551),s=r(78794),o=(r(55512),r(44332)),c=r(44975),a=r(71232),u=r(49919),l=r(43941),p=r(66097),f=r(18513),d=r(49765),m=r(78979),S=r(21571),g=r(43771),k=r(42518),v=r(46170),h=r(78367),_=r(84449),b=r(72623),x=r(97545),w=r(24738),Z=r(62380),F=r(67407),I=r(3972),P=r(39465),U=r(87989),q=r(51852),y=r(58216),C=r(82665),L=r(50279),A=r(87367),R=r(7723),T=r(64514),z=function(){function e(){(0,U.Z)(this,e),(0,y.Z)(this,"itemMap",new Map)}var t,r,n,i,s;return(0,q.Z)(e,[{key:"getPublishInfo",value:function(e){return this.itemMap.get(e)}},{key:"batchPublish",value:(s=(0,p.Z)((0,l.Z)().mark((function e(t){var r,n,i,s,o,c=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=(0,P.Z)((0,C.Z)(t,10)),e.prev=2,n.s();case 4:if((i=n.n()).done){e.next=12;break}return s=i.value,e.next=8,Promise.all(s.map((function(e){return c.publish(e)})));case 8:o=e.sent,r.push.apply(r,(0,I.Z)(o));case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:return e.abrupt("return",r);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])}))),function(e){return s.apply(this,arguments)})},{key:"publish",value:(i=(0,p.Z)((0,l.Z)().mark((function e(t){var r,n,i,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.id,n=t.onResult,i=JSON.parse(JSON.stringify(t.req)),!(s=this.itemMap.get(r))){e.next=18;break}if(!s.promise||!(0,L.Z)(s.req,i)){e.next=14;break}return e.prev=5,e.next=8,s.promise;case 8:return e.abrupt("return",e.sent);case 11:e.prev=11,e.t0=e.catch(5),(0,R.c6)("[MaterialPublishService] publish failed, start to retry",{id:r});case 14:s.req=i,s.onResult=n,e.next=20;break;case 18:s={promise:null,id:r,req:i,onResult:n},this.itemMap.set(r,s);case 20:return s.promise||(s.promise=this.publishImpl(s)),e.abrupt("return",s.promise);case 22:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(e){return i.apply(this,arguments)})},{key:"getErrorText",value:function(e){return e?e.message||JSON.stringify(e):""}},{key:"publishImpl",value:(n=(0,p.Z)((0,l.Z)().mark((function e(t){var r,n,i,s=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=performance.now(),n=function(){var e=(0,p.Z)((0,l.Z)().mark((function e(n,i){var o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(o=t.onResult)||void 0===o?void 0:o.call(t,{req:t.req,error:n,errorText:s.getErrorText(n),time:Math.round(performance.now()-r),resourceId:i});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),(0,R.RF)("[MaterialPublishService] callOnResult failed",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t,r){return e.apply(this,arguments)}}(),e.prev=2,e.next=5,(0,A.TT)(t.req);case 5:i=e.sent,e.next=13;break;case 8:throw e.prev=8,e.t0=e.catch(2),t.promise=null,n(e.t0,""),e.t0;case 13:return e.next=15,n(null,i.resource_id);case 15:return e.abrupt("return",i);case 16:case"end":return e.stop()}}),e,null,[[2,8]])}))),function(e){return n.apply(this,arguments)})},{key:"pollUntilAllInEffectList",value:(r=(0,p.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.race([this.pollUntilAllInEffectListImpl(t),(new T.B).timeout(5e3)]);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),(0,R.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(e){return r.apply(this,arguments)})},{key:"pollUntilAllInEffectListImpl",value:(t=(0,p.Z)((0,l.Z)().mark((function e(t){var r,n,i,s,o,c,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.ids,n=t.types,i=performance.now(),s=new T.B,o={count:50,effect_types:n,uid:_.$.userInfo.uid,cursor:0},c=(0,l.Z)().mark((function e(){var t,n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,A.Js)(o).catch((function(){return null}));case 2:if(null==(t=e.sent)||!t.effect_item_list){e.next=7;break}if(n=new Set(t.effect_item_list.map((function(e){return e.common_attr.id}))),!r.every((function(e){return n.has(e)}))){e.next=7;break}return e.abrupt("return",{v:void 0});case 7:return e.next=9,s.timeout(500);case 9:case"end":return e.stop()}}),e)}));case 5:if(!(performance.now()-i<5e3)){e.next=12;break}return e.delegateYield(c(),"t0",7);case 7:if("object"!=typeof(a=e.t0)){e.next=10;break}return e.abrupt("return",a.v);case 10:e.next=5;break;case 12:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),N=r(52278),M=r(60174),E="ImportSticker";var j=(0,n.createContext)(null),D=function(){return(0,n.useContext)(j)},O=r(11527),B=(0,i.Pi)((function(e){var t=e.className,r=D(),i=(0,s.$)().t,o=(0,n.useRef)(null);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(c.P,{className:t,leftText:i("pc_sticker_import_zero_to_hundred_web",{X:r.importLoadingStore.isImportLoading?0:r.stickerListStore.stickers.length,Y:r.maxStickerCount}),isPublishDisabled:!r.isReadyToPublish,isPublishing:r.isPublishing,needConfirmModalOnClose:r.needConfirmModalOnClose,onPublish:function(){return r.uploadAndPublish(o.current)}}),(0,O.jsx)(a.q,{ref:o,uploadStats:r.stickerListStore.uploadStats,onRetryUpload:r.retryUpload,onCancel:r.isAllUploadedWatcher.stop,onShowUploadFail:r.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:r.handlePromptConfirmToCancel})]})})),$=r(27262),W=r(98893),G=r(78681),J=r(4019),Q="mQZ4F",V=(0,i.Pi)((function(e){var t=e.className,r=D(),n=(0,s.$)().t;return(0,N.pg)(r),(0,O.jsx)($.$,{className:t,layout:r.mainFormLayout,uploadAreaProps:{titleForUploadArea:n("pc_sticker_release_drag_web"),titleForMainForm:n("pc_stickers_release_drag_in_web"),subTitle:n("pc_sticker_release_groups_png_web"),draggingTitle:n("pc_sticker_release_mouse_web"),disabled:r.isImportDisabled,disabledTooltip:n("pc_stickers_release_max_x_web",{X:r.maxStickerCount}),onClick:r.openStickerFilePicker,onDrop:r.uploadDroppedStickerFiles},setFormApi:r.setFormApi,renderStickerArea:function(e){return(0,O.jsxs)(O.Fragment,{children:[e,(0,O.jsx)(W.z,{className:Q,importStickerFileService:r.importServ,onSelect:r.selectSticker,onReimport:r.reimportSticker})]})},renderFormArea:function(){var e=r.stickerListStore.selectedSticker;return e&&(0,O.jsx)(G.E,{importStickerFileService:r.importServ,sticker:e,initFields:r.initFields,controlField:r.field,onStartEditSequenceSettings:function(){return r.sendLogServ.sendStartEditSequenceSettingsLog({})},onSaveSequenceSettings:r.saveSequenceSettings})},scrollAreaRef:r.importServ.stickerListStore.scrollAreaRef,onRetry:J.cb})})),H=r(96057),K="PCbgB",X="levta",Y="JfXPJ",ee="mtsWj",te="KQUUx",re=(0,i.Pi)((function(){var e=function(){var e=(0,h.WQ)(),t=(0,v.WQ)({stickerListStore:e}),r=new N.YL({itemType:w.qG.Sticker}),i=new F.l,s=(0,d.fv)((function(){return{formApi:null,setFormApi:function(e){s.formApi=e},mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===s.mainFormLayoutAfterLoading&&Z.K.isInitFailed?"error":s.mainFormLayoutAfterLoading},get maxStickerCount(){return _.$.permissions.includes(_.v.EffectBatchMore)?50:20},get isImportDisabled(){return e.stickers.length>=s.maxStickerCount},stickerListStore:e,importLoadingStore:t,importServ:new g.T({api:new k.r,stickerListStore:e,sendLogServ:r,needSaveSequenceGifUrl:!1}),pubServ:new z,sendLogServ:r,get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1,canIconBlank:_.$.permissions.includes(_.v.EffectIconBlank),canHighPro:_.$.permissions.includes(_.v.EffectHighPrio),canPackOne:_.$.permissions.includes(_.v.StickerOnePackage)}},get permissions(){return _.$.permissions},getImportMinMaxCount:function(){var t=e.stickers.length;return{minCount:1,maxCount:Math.max(0,s.maxStickerCount-t),maxTotalCount:s.maxStickerCount}},refreshUploadConfigsIfNeeded:function(e){return(0,M.Nr)({logPrefix:"[SingleStore] ",when:e,importServ:s.importServ})},openStickerFilePicker:function(){return i.lock(E,(0,p.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.sendUploadActionLog(s),e.next=3,s.refreshUploadConfigsIfNeeded("openStickerFilePicker");case 3:return e.next=5,s.importServ.openStickerFilePicker(s.getImportMinMaxCount());case 5:t=e.sent,s.addNewStickers(t);case 7:case"end":return e.stop()}}),e)}))))},uploadDroppedStickerFiles:function(){return i.lock(E,(0,p.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.sendUploadActionLog(s),e.next=3,s.refreshUploadConfigsIfNeeded("uploadDroppedStickerFiles");case 3:return e.next=5,s.importServ.uploadDroppedStickerFiles(s.getImportMinMaxCount());case 5:t=e.sent,s.addNewStickers(t);case 7:case"end":return e.stop()}}),e)}))))},reimportSticker:function(t){return i.lock(E,(0,p.Z)((0,l.Z)().mark((function r(){var n,i;return(0,l.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s.refreshUploadConfigsIfNeeded("reimportSticker");case 2:return r.next=4,s.importServ.reimportSticker(t,{});case 4:(n=r.sent)&&(i=e.getSticker(n),s.selectSticker(i));case 6:case"end":return r.stop()}}),r)}))))},addNewStickers:function(r){0!==r.length&&(e.addStickers(r),e.selectSticker(r[0].id),"uploadArea"===s.mainFormLayoutAfterLoading&&(t.showImportLoading(),s.mainFormLayoutAfterLoading="mainForm"))},selectSticker:function(t){s.saveFormState(),e.selectSticker(t.id)},initFields:function(e){var t,r;null===(t=s.formApi)||void 0===t||t.reset(),null===(r=s.formApi)||void 0===r||r.setValues({single:(0,u.Z)((0,u.Z)({},e.formState),e.sequenceSettings)})},saveFormState:function(){var t,r=e.selectedSticker;if(r){var n=e.makeInitFormState((0,u.Z)((0,u.Z)((0,u.Z)({},null===(t=s.formApi)||void 0===t?void 0:t.getValue("single")),r.sequenceSettings),{},{sequenceSettingsApplyToAll:!1}));e.updateFormState(r,n)}},saveSequenceSettings:function(){var t,n=e.makeInitFormState((0,u.Z)({},null===(t=s.formApi)||void 0===t?void 0:t.getValue("single"))),i=n.fps,o=n.loop,c=n.sequenceSettingsApplyToAll,a={fps:i,loop:o};s.importServ.updateSequenceSettings({newSettings:a,isApplyToAll:c}),r.sendSaveSequenceSettingsLog({collection_detail:"collection_material",sequenceSettings:{fps:i,loop:o,sequenceSettingsApplyToAll:c}})},get needConfirmModalOnClose(){return e.stickers.length>0},get isAllUploaded(){var e=s.stickerListStore.uploadStats,t=e.pending,r=e.failed;return!t&&!r},isAllUploadedWatcher:null,isPromptingConfirmToCancel:!1,handlePromptConfirmToCancel:function(e){return(0,p.Z)((0,l.Z)().mark((function t(){var r;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.isPromptingConfirmToCancel=!0,t.next=3,e;case 3:r=t.sent,(0,f.z)((function(){r&&s.isAllUploadedWatcher.stop(),s.isPromptingConfirmToCancel=!1}));case 5:case"end":return t.stop()}}),t)})))()},uploadAndPublish:function(e){return(0,p.Z)((0,l.Z)().mark((function t(){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.sendPageActionLog({action:"publish"}),s.isAllUploaded){t.next=7;break}return t.next=4,s.retryUpload();case 4:return null==e||e.show(),t.next=7,s.isAllUploadedWatcher.start();case 7:return t.prev=7,t.next=10,s.publish();case 10:return t.prev=10,null==e||e.hide(),t.finish(10);case 13:case"end":return t.stop()}}),t,null,[[7,,10,13]])})))()},get isReadyToPublish(){return e.stickers.length>0&&e.isReadyToPublish&&!s.isPublishSucceeded},collectLogData:function(){var t=e.collectLogData(),r=e.isReadyToPublish,n=e.uploadStats,i={stickers:t,stickersCount:t.length,stickersReadyToPublish:r,uploadStats:n};(0,R.c6)("[SingleStore] collectLogData",i)},isPublishing:!1,isPublishSucceeded:!1,publish:function(){return(0,p.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.isPublishing=!0,e.prev=1,e.next=4,s.publishImpl();case 4:e.next=12;break;case 6:return e.prev=6,e.t0=e.catch(1),(0,R.RF)("[SingleStore] publish failed",e.t0),m.FN.error(S.oc.t("pc_sticker_release_failed_retry_web")),(0,f.z)((function(){s.isPublishing=!1})),e.abrupt("return");case 12:(0,f.z)((function(){s.isPublishing=!1,s.isPublishSucceeded=!0})),m.FN.success(S.oc.t("pc_sticker_release_successful_web")),(0,x.ZM)({effect_type:w.qG.Sticker}),setTimeout(x.Nt,1e3);case 16:case"end":return e.stop()}}),e,null,[[1,6]])})))()},publishImpl:function(){return(0,p.Z)((0,l.Z)().mark((function t(){var r,n,i;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.saveFormState(),r=e.makePublishItemList({onResult:function(e,t){return(0,M.gd)({logPrefix:"[SingleStore] ",sticker:e,publishResult:t,importServ:s.importServ,sendLogServ:s.sendLogServ})}}),(0,R.c6)("[SingleStore] stickers publish start",{ids:r.map((function(e){return e.id}))}),t.next=5,s.pubServ.batchPublish(r);case 5:return n=t.sent,i=n.map((function(e){return e.resource_id})),(0,R.c6)("[SingleStore] stickers publish done",{resourceIdList:i}),t.next=10,s.pubServ.pollUntilAllInEffectList({ids:i.slice(-10),types:[w.qG.Sticker]});case 10:(0,R.c6)("[SingleStore] poll done");case 11:case"end":return t.stop()}}),t)})))()},sendUploadProgressModalShowErrorLog:function(){var e=s.stickerListStore.stickers.filter((function(e){return e.isUploadFailed})).map((function(e){return{error_report:s.importServ.getFileStats(e.id).uploadError}}));r.sendStickerPublishErrorLog(e)},retryUpload:function(){return this.importServ.retryUpload([])}}}),{formApi:!1,isAllUploadedWatcher:!1});return s.isAllUploadedWatcher=(0,b.e)({watch:function(){return s.isAllUploaded&&!s.isPromptingConfirmToCancel}}),(0,M.LP)({watch:function(){s.stickerListStore.uploadStats,s.isReadyToPublish},collect:s.collectLogData}),(0,n.useEffect)((function(){window.store=s;var e=(0,f.EH)((function(){var e=s.needConfirmModalOnClose;(0,x.c0)({isNeed:e})}));return s.importServ.uploadConfigsCache.updateCache(),function(){t.destroy(),s.importServ.destroy(),e()}}),[]),s}(),t=(0,s.$)().t,r=e.importServ.stickerListStore.selectedSticker;return(0,H.F)({title:t("pc_stickers_release_ing_web"),pid:"sticker-publish-single"}),(0,N.t9)(e.sendLogServ),(0,O.jsxs)(j.Provider,{value:e,children:[(0,O.jsxs)("div",{className:K,children:[(0,O.jsxs)("div",{className:X,children:[(0,O.jsx)(o.n,{className:Y,sticker:r}),(0,O.jsx)(V,{className:ee})]}),(0,O.jsx)(B,{className:te})]}),!1]})})),ne=function(){return(0,n.useEffect)((function(){Z.K.setEntryPage("sticker-entry")}),[]),(0,O.jsx)(re,{})}},4365:function(e,t,r){r.d(t,{BI:function(){return k},N7:function(){return p},Q0:function(){return f},R8:function(){return u},S8:function(){return S},fD:function(){return l},mr:function(){return m},pM:function(){return g},rg:function(){return d}});var n,i,s,o,c=r(58216),a=r(21571),u=function(e){return e.Static="static",e.GIF="gif",e.Sequence="sequence",e}({}),l=function(e){return e.Format="format",e.MinImageSize="minImageSize",e.RecommendFileSize="RecommendFileSize",e.SequenceNumber="SequenceNumber",e}({}),p={fps:16,loop:!0},f={maxCount:49,minCount:2,minImageSize:360,maxImageSize:1080,maxFileSize:20971520},d={accept:".png,.jpg,.jpeg,.gif",multiple:!0,enableImportSequence:!0,thumbnailSize:200,minImageSize:360,maxImageSize:800,maxFileSize:20971520},m={fps:16,loop:!0,gen_size:0,gif_gen_opts:[{bg_color:"#242424",width:200,height:200,padding:0},{bg_color:"",width:0,height:0,padding:0}]},S=40,g=15,k=(o={},(0,c.Z)(o,u.Static,(n={},(0,c.Z)(n,l.Format,a.oc.t("pc_stickers_release_format_web")),(0,c.Z)(n,l.MinImageSize,a.oc.t("pc_stickers_release_size_min_web")),(0,c.Z)(n,l.RecommendFileSize,a.oc.t("pc_stickers_release_recommend_web")),n)),(0,c.Z)(o,u.GIF,(i={},(0,c.Z)(i,l.Format,a.oc.t("pc_stickers_release_format_gif_web")),(0,c.Z)(i,l.MinImageSize,a.oc.t("pc_stickers_release_size_min_web")),(0,c.Z)(i,l.RecommendFileSize,a.oc.t("pc_stickers_release_recommend_web")),i)),(0,c.Z)(o,u.Sequence,(s={},(0,c.Z)(s,l.Format,a.oc.t("pc_stickers_release_png_groups_web_web")),(0,c.Z)(s,l.MinImageSize,a.oc.t("pc_stickers_release_reccomend_size_web")),(0,c.Z)(s,l.SequenceNumber,a.oc.t("pc_stickers_release_amount_web")),(0,c.Z)(s,l.RecommendFileSize,a.oc.t("pc_stickers_release_recommend_web")),s)),o)},78367:function(e,t,r){r.d(t,{B3:function(){return S},Nf:function(){return g},WQ:function(){return v},w3:function(){return k}});var n=r(17576),i=r(49919),s=r(3972),o=r(29391),c=r(50959),a=r(49765),u=r(4365),l=r(87367),p=r(24738),f=r(67819),d=r(18672),m=["title","isInfoComplete","formState","path","isSequence"];function S(e){return e.coverSrc||e.firstFrameCoverSrc}function g(e){return e.isSequence&&Boolean(e.isSequenceSettingsUpdating||e.firstFrameCoverSrc&&!e.coverSrc)}function k(e){return e.isSequence||"gif"===(0,d.lm)(e.path)}function v(){var e=(0,a.fv)((function(){return{stickers:[],scrollAreaRef:(0,c.createRef)(),get hasStickers(){return this.stickers.length>0},selectedId:null,get selectedSticker(){return e.selectedId?e.getSticker(e.selectedId):null},setScrollAreaRef:function(t){e.scrollAreaRef=t},addStickers:function(t){var r;(r=e.stickers).push.apply(r,(0,s.Z)(t))},getSticker:function(t){var r;return null!==(r=e.stickers.find((function(e){return e.id===t})))&&void 0!==r?r:null},selectSticker:function(t){e.selectedId=t,e.selectedSticker&&(e.selectedSticker.hasEverSelected=!0)},updateThumbnailSrc:function(e,t){e.isSequence?e.firstFrameCoverSrc=t:e.coverSrc=t},updateUploadedData:function(e,t,r){if(e.uri=t,!e.isSequence)return e.coverUri=t,void(e.largeImageUri=t);if(r){var n=r.gifCover,i=r.gifLargeImage,s=r.stickerPackage;e.coverUri=n.uri,e.coverSrc=n.blobUrl,e.largeImageUri=i.uri,e.stickerPackage=s,e.isSequenceSettingsUpdating=!1}},updateUnmetRequirements:function(e,t){e.unmetRequirements=t,e.hasCheckedRequirements=!0},setUploadFailed:function(e){e.isUploadFailed=!0},get isAllStickersThumbnailReady(){return e.stickers.length>0&&e.stickers.every((function(e){return S(e)}))},applyForTags:function(t){e.stickers.forEach((function(e){e.formState.tags=t}))},makeInitFormState:function(e){return(0,i.Z)((0,i.Z)({title:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:!1},u.N7),{},{sequenceSettingsApplyToAll:!1},e)},updateFormState:function(e,t){Object.assign(e.formState,t)},makeInitSticker:function(t){t.title,t.isInfoComplete,t.formState;var r=t.path,s=void 0===r?"":r,o=t.isSequence,c=void 0!==o&&o,a=(0,n.Z)(t,m),l=function(e,t){var r=(0,d.lm)(e);if(t)return u.R8.Sequence;if("gif"===r)return u.R8.GIF;if(["png","jpg","jpeg"].includes(r))return u.R8.Static;throw new Error("Unsupported suffix ".concat(r))}(s,c),p=function(e,t){var r=e.split(/[\\/]/g).pop(),n=t?r:r.replace(/\.\w+?$/g,"");return(0,f.a)(n,u.S8)}(s,c);return(0,i.Z)({id:"",path:s,get title(){return this.formState.title},fileType:l,width:0,height:0,isSequence:c,firstFrameCoverSrc:"",coverSrc:"",uri:"",coverUri:"",largeImageUri:"",stickerPackage:{uri:"",md5:"",size:0},sequenceSettings:(0,i.Z)({fps:0,loop:!1},t.isSequence&&u.N7),hasEverSelected:!1,get isInfoComplete(){return Boolean(this.hasEverSelected&&this.title&&this.formState.tags.length>0)},unmetRequirements:[],hasCheckedRequirements:!1,isUploadFailed:!1,isSequenceSettingsUpdating:!1,formState:e.makeInitFormState({title:p})},a)},reimportSticker:function(t,r){var n=e.stickers.findIndex((function(e){return e.id===t}));-1!==n&&(e.stickers[n]=r)},startToRetryUploadStickers:function(t){t.forEach((function(t){var r=e.getSticker(t);r&&(r.isUploadFailed=!1)}))},startToUpdateSequenceSettings:function(e,t){e.forEach((function(e){e.sequenceSettings=t,e.largeImageUri&&(e.largeImageUri="",e.coverUri="",e.stickerPackage={uri:"",md5:"",size:0},e.isSequenceSettingsUpdating=!0)}))},removeSticker:function(t){e.stickers=e.stickers.filter((function(e){return e.id!==t.id}))},dragInsert:function(t,r){var n,i=e.stickers.splice(t,1),o=t>r?r+1:r;(n=e.stickers).splice.apply(n,[o,0].concat((0,s.Z)(i)))},get isReadyToPublish(){return e.stickers.every((function(e){return e.hasCheckedRequirements&&0===e.unmetRequirements.length&&e.isInfoComplete}))},get uploadStats(){var t=0,r=0,n=0;return e.stickers.forEach((function(e){e.isUploadFailed?r+=1:(e.isSequence?e.largeImageUri:e.uri)?t+=1:n+=1})),{pending:n,succeeded:t,failed:r}},collectLogData:function(){return e.stickers.map((function(e){return(0,i.Z)((0,i.Z)({},(0,o.Z)(e,["id","isSequence","isInfoComplete","hasEverSelected","isUploadFailed","uri"])),e.isSequence&&(0,i.Z)({isSequenceUpdating:e.isSequenceSettingsUpdating,largeImageUri:e.largeImageUri},e.sequenceSettings))}))},makePublishItemList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.stickers.map((function(e){var r=e.id,n=e.isSequence,o=e.formState,c=e.stickerPackage,a=t.is_vip,u=void 0===a?Boolean(o.isVip):a,f=t.is_business,d=void 0===f?o.isBusiness:f,m=t.is_original,S=void 0===m?o.isOriginal:m,g=t.sourceForSimple,v=void 0===g?l.r0.UserPostPc:g,h=t.sourceForSequence,_=void 0===h?l.r0.UserPostPcSequence:h,b=t.onResult,x=n?_:v;return{id:r,req:{effect_type:p.qG.Sticker,is_vip:u,common_data:(0,i.Z)({title:o.title,description:o.title,icon:{image_uri:e.coverUri},sdk_version:"1.0.0",source:x,tags:(0,s.Z)(o.tags),is_original:S,is_business:d,web_extra:""},n&&{file:{file_uri:c.uri,file_md5:c.md5,size:c.size}}),sticker:{large_image:{image_uri:e.largeImageUri},sticker_type:k(e)?l.Ic.Dynamic:l.Ic.Static,no_multi_sticker:!1,package_size:0}},onResult:function(t){return null==b?void 0:b(e,t)}}}))}}}));return e}},18672:function(e,t,r){r.d(t,{F2:function(){return c},J9:function(){return o},lm:function(){return a}});var n=r(43941),i=r(66097),s=(r(96706),function(e){return URL.createObjectURL(e)}),o=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return r=e.sent,e.next=5,r.blob();case 5:return i=e.sent,e.abrupt("return",s(i));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=function(e){return"data:".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",";base64,").concat(e)};var a=function(e){return e.toLowerCase().split(".").pop()}},86094:function(e,t,r){r.d(t,{O1:function(){return i},xB:function(){return s}});var n=r(29922);r(38023);var i=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split("").reduce((function(e,t){return e+(/^[\u4e00-\u9fa5]$/.test(t)?2:1)}),0)};function s(e){var t=e.len,r=(e.i18n.language||"").split("-");return"zh"===(0,n.Z)(r,1)[0]?Math.floor(t/2):t}}}]);