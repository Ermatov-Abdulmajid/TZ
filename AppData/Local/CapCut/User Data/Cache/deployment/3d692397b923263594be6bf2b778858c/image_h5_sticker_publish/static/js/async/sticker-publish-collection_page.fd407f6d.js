"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[843],{32161:function(e,t,r){r.r(t),r.d(t,{default:function(){return Pt}});var n=r(50959),i=r(21551),o=r(78794),c=(r(55512),r(44332)),s=r(27262),a=r(98893),l=r(84875),u=r.n(l),d=r(88842),p=r(4258),m=r(3972),f=r(43941),g=r(66097),v=r(49919),S=r(29391),h=r(78979),_=r(18513),k=r(49765),x=r(21571),C=r(84449),b=r(43771),I=r(42518),w=r(46170),F=r(78367),Z=r(4365),y=r(18672),U=r(72623);r(34210),r(86094);var N,j=r(87367),q=r(58216),E=(r(27049),r(62380)),P=function(e){return e[e.Video=1]="Video",e[e.Image=2]="Image",e[e.Object=7]="Object",e}({});N={},(0,q.Z)(N,P.Video,"video"),(0,q.Z)(N,P.Image,"image"),(0,q.Z)(N,P.Object,"object");function L(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return e?"".concat(e,"-").concat(t):t}var A=r(97545),R=r(24738),T=r(67407),z=r(36928),M=r(39465),O=r(87989),D=r(51852),B=r(82665),G=r(50279),X=r(7723),W=r(64514),V=function(){function e(){(0,O.Z)(this,e),(0,q.Z)(this,"itemMap",new Map)}var t,r,n,i,o;return(0,D.Z)(e,[{key:"getPublishInfo",value:function(e){return this.itemMap.get(e)}},{key:"batchPublish",value:(o=(0,g.Z)((0,f.Z)().mark((function e(t){var r,n,i,o,c,s=this;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=(0,M.Z)((0,B.Z)(t,10)),e.prev=2,n.s();case 4:if((i=n.n()).done){e.next=12;break}return o=i.value,e.next=8,Promise.all(o.map((function(e){return s.publish(e)})));case 8:c=e.sent,r.push.apply(r,(0,m.Z)(c));case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:return e.abrupt("return",r);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])}))),function(e){return o.apply(this,arguments)})},{key:"publish",value:(i=(0,g.Z)((0,f.Z)().mark((function e(t){var r,n,i,o;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.id,n=t.onResult,i=JSON.parse(JSON.stringify(t.req)),!(o=this.itemMap.get(r))){e.next=18;break}if(!o.promise||!(0,G.Z)(o.req,i)){e.next=14;break}return e.prev=5,e.next=8,o.promise;case 8:return e.abrupt("return",e.sent);case 11:e.prev=11,e.t0=e.catch(5),(0,X.c6)("[MaterialPublishService] publish failed, start to retry",{id:r});case 14:o.req=i,o.onResult=n,e.next=20;break;case 18:o={promise:null,id:r,req:i,onResult:n},this.itemMap.set(r,o);case 20:return o.promise||(o.promise=this.publishImpl(o)),e.abrupt("return",o.promise);case 22:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(e){return i.apply(this,arguments)})},{key:"getErrorText",value:function(e){return e?e.message||JSON.stringify(e):""}},{key:"publishImpl",value:(n=(0,g.Z)((0,f.Z)().mark((function e(t){var r,n,i,o=this;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=performance.now(),n=function(){var e=(0,g.Z)((0,f.Z)().mark((function e(n,i){var c;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(c=t.onResult)||void 0===c?void 0:c.call(t,{req:t.req,error:n,errorText:o.getErrorText(n),time:Math.round(performance.now()-r),resourceId:i});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),(0,X.RF)("[MaterialPublishService] callOnResult failed",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t,r){return e.apply(this,arguments)}}(),e.prev=2,e.next=5,(0,j.TT)(t.req);case 5:i=e.sent,e.next=13;break;case 8:throw e.prev=8,e.t0=e.catch(2),t.promise=null,n(e.t0,""),e.t0;case 13:return e.next=15,n(null,i.resource_id);case 15:return e.abrupt("return",i);case 16:case"end":return e.stop()}}),e,null,[[2,8]])}))),function(e){return n.apply(this,arguments)})},{key:"pollUntilAllInEffectList",value:(r=(0,g.Z)((0,f.Z)().mark((function e(t){return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.race([this.pollUntilAllInEffectListImpl(t),(new W.B).timeout(5e3)]);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),(0,X.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(e){return r.apply(this,arguments)})},{key:"pollUntilAllInEffectListImpl",value:(t=(0,g.Z)((0,f.Z)().mark((function e(t){var r,n,i,o,c,s,a;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.ids,n=t.types,i=performance.now(),o=new W.B,c={count:50,effect_types:n,uid:C.$.userInfo.uid,cursor:0},s=(0,f.Z)().mark((function e(){var t,n;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,j.Js)(c).catch((function(){return null}));case 2:if(null==(t=e.sent)||!t.effect_item_list){e.next=7;break}if(n=new Set(t.effect_item_list.map((function(e){return e.common_attr.id}))),!r.every((function(e){return n.has(e)}))){e.next=7;break}return e.abrupt("return",{v:void 0});case 7:return e.next=9,o.timeout(500);case 9:case"end":return e.stop()}}),e)}));case 5:if(!(performance.now()-i<5e3)){e.next=12;break}return e.delegateYield(s(),"t0",7);case 7:if("object"!=typeof(a=e.t0)){e.next=10;break}return e.abrupt("return",a.v);case 10:e.next=5;break;case 12:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),$=r(52278),J=r(60174),Y="ImportSticker";function K(e){return(0,v.Z)((0,v.Z)({title:"",description:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:!1},Z.N7),{},{sequenceSettingsApplyToAll:!1},e)}var H,Q=(0,n.createContext)(null),ee=function(){return(0,n.useContext)(Q)},te=r(3088),re="XMSiW",ne="HNM54",ie="H7JBM",oe="RPgEZ",ce="hIArS",se="r9Z34",ae="T_tWR",le="B0mBD",ue="nmij1",de=r(11527),pe=(0,i.Pi)((function(e){var t=e.className,r=ee(),n=(0,o.$)().t,i=r.isCollectionCoverCardSelected,c=r.collection,s=c.cover,a=c.title,l=c.description,m=c.isInfoComplete,f=(0,te.S)().handleMouseEnter;return(0,de.jsxs)("div",{className:u()(t,re,i&&ne),onClick:r.selectCollectionCoverCard,children:[(0,de.jsx)("div",{className:ie,children:s.url?(0,de.jsx)("img",{className:oe,src:s.url}):(0,de.jsx)(d.t,{className:oe,iconWidth:28})}),(0,de.jsxs)("div",{className:ce,children:[(0,de.jsx)("div",{className:se,onMouseEnter:f,children:a||n("pc_stickers_release_group_name_web")}),(0,de.jsx)("div",{className:ae,onMouseEnter:f,children:l||n("pc_stickers_release_details_recommend_web")})]}),m?(0,de.jsx)(p.Bo,{className:ue,text:n("pc_stickers_release_finish_fill_web")}):(0,de.jsx)(p.LU,{className:le})]})}));function me(){return me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},me.apply(this,arguments)}var fe=function(e){return n.createElement("svg",me({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),H||(H=n.createElement("path",{fill:"#D4A500",d:"M8 14c3.292 0 6-2.71 6-6.003C14 4.703 11.292 2 8 2S2 4.703 2 7.997C2 11.29 4.708 14 8 14Zm0-5.142c-.391 0-.62-.217-.638-.614l-.09-2.493c-.024-.421.277-.704.722-.704.445 0 .752.289.728.71l-.09 2.48c-.018.404-.247.621-.632.621Zm0 2.047c-.445 0-.794-.283-.794-.71 0-.428.349-.717.794-.717.451 0 .788.29.788.717s-.343.71-.788.71Z"})))},ge=r(42677),ve=r(93001),Se="h2sE_",he="_sa13",_e="bnxOD",ke=(0,i.Pi)((function(e){var t,r,n,i,c=e.className,s=e.onClick,a=ee(),l=(0,o.$)().t,d=(t=a.stickersForOnlineImageEditorStats,r=t.ready,n=t.pending,i=t.failed,r<4?{tooltip:l("pc_sticker_import_least_{X}_web",{X:4}),percent:null}:0===n&&0===i?null:{tooltip:a.retryTimesForOnlineImageEditor>1?l("pc_sticker_failed_retrying_web"):l("pc_sticker_loading_web"),percent:Math.floor(r/(r+n+i)*100)}),p=(0,te.w)({content:null==d?void 0:d.tooltip,cursor:"not-allowed"}).handleMouseEnter;return(0,de.jsxs)("div",{className:u()(c,Se,d&&he),onClick:function(e){d?e.stopPropagation():s(e)},onMouseEnter:d?p:void 0,children:[(0,de.jsx)("span",{children:l("pc_stickers_release_online_puzzle_web")}),d&&null!==d.percent&&(0,de.jsxs)("span",{className:_e,children:[d.percent,"%"]})]})})),xe="DAPiU",Ce="pmTIq",be="rar1f",Ie="jQsav",we="v9MMa",Fe="nxsqs",Ze="pl1vX",ye="ArhV3",Ue="BnZPL",Ne="WKyYC",je="xFvUf",qe="Y_muq",Ee=(0,i.Pi)((function(e){var t=ee(),r=(0,o.$)().t,n=t.collection.cover;return(0,de.jsxs)("div",{className:xe,children:[(0,de.jsx)("div",{className:Ce,children:n.url?(0,de.jsx)("img",{className:be,src:n.url}):(0,de.jsx)(d.t,{className:be,iconWidth:28})}),n.isUploadFailed?(0,de.jsx)("div",{className:Ie,children:(0,de.jsx)("span",{className:Fe,children:r("pc_stickers_release_error_x_web",{X:(0,de.jsx)("span",{className:Ze,onClick:t.retryUpload,children:r("pc_stickers_release_click_again_web")},"X")})})}):n.url?(0,de.jsx)("div",{className:Ie}):n.needImport?(0,de.jsxs)("div",{className:Ie,children:[(0,de.jsx)(fe,{height:16,width:16}),(0,de.jsx)("span",{className:ye,children:r("pc_stickers_release_add_cover_web")})]}):(0,de.jsxs)("div",{className:Ie,children:[(0,de.jsx)(ge.a,{size:12,arcColor:"grey-1"}),(0,de.jsx)("span",{className:we,children:r("pc_stickers_release_in_web")})]}),(0,de.jsx)("div",{className:Ue}),(0,de.jsx)(h.J2,{position:"bottomRight",trigger:"click",className:je,clickToHide:!0,onVisibleChange:function(e){e&&t.retryUploadForOnlineImageEditor()},content:(0,de.jsx)(ve.m,{items:[{key:"openCoverImageEditor",render:function(e){var r=e.key,n=e.className;return(0,de.jsx)(ke,{className:n,onClick:t.openCoverImageEditor},r)}},{key:"localUploadCover",render:function(e){var n=e.key,i=e.className;return(0,de.jsx)("div",{className:u()(i,qe),onClick:t.localUploadCover,children:r("pc_stickers_release_local_web")},n)}}]}),children:(0,de.jsx)("div",{className:Ne,children:r("pc_stickers_release_cover_edit_web")})})]})})),Pe=r(36004),Le=r(43637),Ae=r(23826),Re=r(47071),Te="dY0Sc",ze="AGHWK",Me="j9ob_",Oe="D79ce",De="g4kRt",Be=function(e){var t=e.className,r=e.rules;return(0,de.jsx)("div",{className:u()([Te,t]),children:r.map((function(e,t){return(0,de.jsxs)("div",{className:ze,children:[(void 0===e.status||"normal"===e.status)&&(0,de.jsx)("div",{className:Me}),"success"===e.status&&(0,de.jsx)(Re.CDR,{className:Oe}),(0,de.jsx)("p",{className:De,children:e.content})]},t)}))})},Ge=r(20014),Xe="Di45L",We="CTwgR",Ve="_cQO2",$e="XYak9",Je="TkySq",Ye="bxiNX",Ke="dui33",He="Y3jDP",Qe="ii4Gr",et="alv0g",tt="fkbiK",rt="Nl1UG",nt="ERMd7",it="KKoKY",ot="KS5pF",ct="vzhiR",st=function(){var e=(0,o.$)().t;return(0,de.jsxs)("div",{className:Ve,children:[e("pc_sticker_sample_web"),(0,de.jsx)(h.J2,{content:(0,de.jsx)("div",{className:nt,children:(0,de.jsx)(Be,{rules:[{content:"".concat(e("file_format_web"),"PNG/GIF")},{content:e("pc_stickers_prompt_w_{X}_h_{Y}_web",{X:"1000px",Y:"1250px"})},{content:e("file_size_limit_web",{X:5})}]})}),children:(0,de.jsx)(Re.qwp,{size:"small",className:$e})})]})},at=(0,i.Pi)((function(e){var t=e.className,r=ee(),i=(0,o.$)().t,c=r.collection.exampleImages[0],s=(0,Ge.D)({content:(0,de.jsx)(ve.m,{items:[{key:"remove",render:function(e){var t=e.key,n=e.className;return(0,de.jsx)("div",{className:u()(n,it),onClick:r.removeExample,children:i("pc_stickers_release_delete_web")},t)}}]})}),a=s.handleContextMenu,l=(0,n.useMemo)((function(){var e=c;return e?null!=e&&e.url?(0,de.jsx)("div",{className:He,children:(0,de.jsx)("img",{className:Qe,src:null==e?void 0:e.url,alt:""})}):(0,de.jsx)("div",{className:He,children:(0,de.jsx)(d.t,{className:ct,iconWidth:17})}):null}),[null==c?void 0:c.isUploadFailed,null==c?void 0:c.url]);return(0,de.jsx)("div",{className:u()(Xe,t),children:(0,de.jsxs)("div",{className:We,children:[(0,de.jsx)(st,{}),(0,de.jsx)("div",{className:Ke,onContextMenu:function(e){a(e)},children:(0,de.jsxs)(de.Fragment,{children:[l,null!=c&&c.isUploadFailed?(0,de.jsx)("div",{className:et,children:i("pc_stickers_release_error_x_web",{X:(0,de.jsx)("span",{className:rt,onClick:r.retryUpload,children:i("pc_stickers_release_click_again_web")},"X")})}):null==c||!c.id||null!=c&&c.url?null:(0,de.jsxs)("div",{className:et,children:[(0,de.jsx)(ge.a,{size:12,arcColor:"grey-1"}),(0,de.jsx)("span",{className:tt,children:i("pc_stickers_release_in_web")})]})]})}),(0,de.jsx)("div",{className:Je,children:(0,de.jsx)(h.J2,{position:"bottomRight",trigger:"click",clickToHide:!0,content:(0,de.jsx)(ve.m,{items:[{key:"openCoverImageEditor",render:function(e){var t=e.key,n=e.className;return(0,de.jsx)(ke,{className:n,onClick:r.openExampleImageEditor},t)}},{key:"localUploadCover",render:function(e){var t=e.key,n=e.className;return(0,de.jsx)("div",{className:u()(n,ot),onClick:r.localUploadExample,children:i("pc_stickers_release_local_web")},t)}}]}),children:(0,de.jsx)("span",{className:Ye,children:i("pc_sticker_edit_web")})})})]})})})),lt=r(66923),ut=r(40209),dt="Y3t4f",pt="pSTiz",mt="GobyY",ft="rdBOX",gt="oaUZM",vt="Tv3I_",St="oAheg",ht="QOmoR",_t=(0,i.Pi)((function(){var e=(0,o.$)(),t=e.t,r=(e.i18n,ee()),i=r.importServ,c=r.collection,s=i.stickerListStore;(0,n.useLayoutEffect)((function(){return r.initCollectionFields()}),[]);var a=(0,ut._)().getDisplayLength;return(0,de.jsxs)("div",{className:dt,children:[(0,de.jsx)(Ee,{}),(0,de.jsx)(Pe.l,{fieldClassName:ht,label:t("pc_stickers_release_group_name_web"),field:"collection.title",maxLength:Z.S8,noErrorMessage:!0,isCanEnter:!1,placeholder:t("pc_stickers_release_xy_name_web",{X:1,Y:a(Z.S8)}),rules:[{required:!0,message:""}],onChange:function(e){return r.updateCollectionFormState({title:e})}}),(0,de.jsx)(Pe.l,{fieldClassName:ht,label:t("pc_stickers_release_details_recommend_web"),field:"collection.description",maxLength:Z.Us,isCanEnter:!1,placeholder:t("pc_stickers_release_xy_details_web",{X:1,Y:a(Z.Us)}),onChange:function(e){return r.updateCollectionFormState({description:e})}}),(0,de.jsxs)("div",{className:pt,children:[(0,de.jsx)(Le.u,{fieldClassName:ht,label:t("pc_stickers_release_tag_set_web"),placeholder:t("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"collection.tags",itemType:R.qG.Sticker,noErrorMessage:!0,recommendConfig:{title:c.title,uri:c.cover.uri},rules:[{required:!0,message:t("pc_stickers_release_max_tag_web",{X:Z.pM})}],onChange:function(e){return r.updateCollectionFormState({tags:e})}}),(0,de.jsx)("span",{className:mt,onClick:function(){var e,t,n=null===(e=r.formApi)||void 0===e?void 0:e.getValues();s.applyForTags((null==n||null===(t=n.collection)||void 0===t?void 0:t.tags)||[])},children:t("pc_stickers_release_apply_all_web")})]}),(0,de.jsxs)("div",{className:ft,children:[r.field.canOriginal&&(0,de.jsx)(Ae.V,{noLabel:!0,field:"collection.isOriginal",itemType:R.qG.Sticker}),r.field.canBusiness&&(0,de.jsx)(h.l0.Checkbox,{noLabel:!0,field:"collection.isBusiness",children:t("commercial_stickers_web")}),r.field.canVip&&(0,de.jsx)(h.l0.Checkbox,{noLabel:!0,field:"collection.isVip",children:t("to_pay_for_stickers_web")})]}),(0,de.jsx)("div",{className:gt,children:t("pc_stickers_release_higher_settings_web")}),(0,de.jsx)(at,{className:vt}),r.field.canFpsSetting&&(0,de.jsx)(lt.ZP,{className:St,prefix:"collection",onStartEdit:function(){return r.sendLogServ.sendStartEditSequenceSettingsLog({})},onSave:r.saveSequenceSettingsForCollection})]})})),kt=r(78681),xt=r(4019),Ct="sHAKJ",bt=(0,i.Pi)((function(e){var t=e.className,r=ee(),n=(0,o.$)().t;return(0,$.pg)(r),(0,de.jsx)(s.$,{className:t,layout:r.mainFormLayout,uploadAreaProps:{titleForUploadArea:n("pc_sticker_release_drag_web"),titleForMainForm:n("pc_stickers_release_drag_in_web"),subTitle:n("pc_sticker_release_groups_png_web"),draggingTitle:n("pc_sticker_release_mouse_web"),disabled:r.isImportDisabled,disabledTooltip:n("pc_stickers_release_max_x_web",{X:Z.qb}),onClick:r.openStickerFilePicker,onDrop:r.uploadDroppedStickerFiles},setFormApi:r.setFormApi,renderStickerArea:function(e){return(0,de.jsxs)(de.Fragment,{children:[e,(0,de.jsx)(pe,{className:Ct}),(0,de.jsx)(a.z,{importStickerFileService:r.importServ,onSelect:r.selectSticker,onReimport:r.reimportSticker})]})},renderFormArea:function(){if(r.isCollectionCoverCardSelected)return(0,de.jsx)(_t,{});var e=r.stickerListStore.selectedSticker;return e&&(0,de.jsx)(kt.E,{importStickerFileService:r.importServ,sticker:e,initFields:r.initSingleFields,onStartEditSequenceSettings:function(){return r.sendLogServ.sendStartEditSequenceSettingsLog({collection_detail:"collection_material"})},onSaveSequenceSettings:r.saveSequenceSettingsForSingle})},scrollAreaRef:r.importServ.stickerListStore.scrollAreaRef,onRetry:xt.cb})})),It=r(44975),wt=r(71232),Ft=(0,i.Pi)((function(e){var t=e.className,r=ee(),i=(0,n.useRef)(null),c=(0,o.$)().t;return(0,de.jsxs)(de.Fragment,{children:[(0,de.jsx)(It.P,{className:t,leftText:c("pc_sticker_release_X_web",{X:r.importLoadingStore.isImportLoading?0:r.stickerListStore.stickers.length,Y:Z.r$,Z:Z.qb}),isPublishDisabled:!r.isReadyToPublish,isPublishing:r.isPublishing,needConfirmModalOnClose:r.needConfirmModalOnClose,onPublish:function(){return r.uploadAndPublish(i.current)}}),(0,de.jsx)(wt.q,{ref:i,uploadStats:r.uploadStats,onRetryUpload:r.retryUpload,onCancel:r.isAllUploadedWatcher.stop,onShowUploadFail:r.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:r.handlePromptConfirmToCancel})]})})),Zt=r(96057),yt="laeHs",Ut="tJ0Zd",Nt="vf5Wi",jt="FMl5W",qt="q4d0E",Et=(0,i.Pi)((function(){var e=function(){var e=(0,F.WQ)(),t=(0,w.WQ)({stickerListStore:e}),r=new $.YL({itemType:R.qG.StickerCollection}),i=new T.l,o=(0,k.fv)((function(){return{formApi:null,setFormApi:function(e){o.formApi=e},mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===o.mainFormLayoutAfterLoading&&E.K.isInitFailed?"error":o.mainFormLayoutAfterLoading},get isImportDisabled(){return e.stickers.length>=Z.qb},stickerListStore:e,importLoadingStore:t,importServ:new b.T({api:new I.r,stickerListStore:e,sendLogServ:r,needSaveSequenceGifUrl:!0}),pubServ:new V,sendLogServ:r,getImportMinMaxCount:function(){var t=e.stickers.length;return{minCount:1,maxCount:Math.max(0,Z.qb-t),maxTotalCount:Z.qb}},getHasImportedType:function(){var t=e.stickers;return 0===t.length?"":t.every(F.w3)?"dynamic":"static"},getStaticDynamicMixParams:function(){return{needCheckStaticDynamicMix:!0,hasImportedType:o.getHasImportedType()}},refreshUploadConfigsIfNeeded:function(e){return(0,J.Nr)({logPrefix:"[CollectionStore] ",when:e,importServ:o.importServ})},openStickerFilePicker:function(){return i.lock(Y,(0,g.Z)((0,f.Z)().mark((function e(){var t;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.sendUploadActionLog(o),e.next=3,o.refreshUploadConfigsIfNeeded("openStickerFilePicker");case 3:return e.next=5,o.importServ.openStickerFilePicker((0,v.Z)((0,v.Z)({},o.getImportMinMaxCount()),o.getStaticDynamicMixParams()));case 5:t=e.sent,o.addNewStickers(t);case 7:case"end":return e.stop()}}),e)}))))},uploadDroppedStickerFiles:function(){return i.lock(Y,(0,g.Z)((0,f.Z)().mark((function e(){var t;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.sendUploadActionLog(o),e.next=3,o.refreshUploadConfigsIfNeeded("uploadDroppedStickerFiles");case 3:return e.next=5,o.importServ.uploadDroppedStickerFiles((0,v.Z)((0,v.Z)({},o.getImportMinMaxCount()),o.getStaticDynamicMixParams()));case 5:t=e.sent,o.addNewStickers(t);case 7:case"end":return e.stop()}}),e)}))))},reimportSticker:function(t){return i.lock(Y,(0,g.Z)((0,f.Z)().mark((function r(){var n,i;return(0,f.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,o.refreshUploadConfigsIfNeeded("reimportSticker");case 2:return r.next=4,o.importServ.reimportSticker(t,o.getStaticDynamicMixParams());case 4:(n=r.sent)&&(i=e.getSticker(n),o.selectSticker(i));case 6:case"end":return r.stop()}}),r)}))))},addNewStickers:function(r){if(0!==r.length)if(e.addStickers(r),"uploadArea"===o.mainFormLayoutAfterLoading)o.selectCollectionCoverCard(),t.showImportLoading(),o.mainFormLayoutAfterLoading="mainForm",o.startCheckGenerateCollectionCover();else{var n=e.getSticker(r[0].id);o.selectSticker(n)}},collection:{id:L("sticker-collection"),cover:{id:"",url:"",uri:"",needImport:!0,isUploadFailed:!1},exampleImages:[],get title(){return this.formState.title},get description(){return this.formState.description},hasEverSelected:!1,get isInfoComplete(){return Boolean(this.hasEverSelected&&this.cover.id&&this.title&&this.formState.tags.length>0)},formState:K({})},isCollectionCoverCardSelected:!0,get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1,canIconBlank:C.$.permissions.includes(C.v.EffectIconBlank),canHighPro:C.$.permissions.includes(C.v.EffectHighPrio),canPackOne:C.$.permissions.includes(C.v.StickerOnePackage),canFpsSetting:e.stickers.some((function(e){return e.isSequence}))}},get permissions(){return C.$.permissions},selectSticker:function(t){o.isCollectionCoverCardSelected&&(o.isCollectionCoverCardSelected=!1,o.saveCollectionFormState()),o.saveSingleFormState(),e.selectSticker(t.id)},selectCollectionCoverCard:function(){o.saveSingleFormState(),e.selectSticker(null),o.isCollectionCoverCardSelected=!0,o.collection.hasEverSelected=!0},initCollectionFields:function(){var e,t;null===(e=o.formApi)||void 0===e||e.reset(),null===(t=o.formApi)||void 0===t||t.setValues({collection:o.collection.formState})},updateCollectionFormState:function(e){Object.assign(o.collection.formState,e)},saveCollectionFormState:function(){var e;o.updateCollectionFormState(K((0,v.Z)({},null===(e=o.formApi)||void 0===e?void 0:e.getValue("collection"))))},initSingleFields:function(e){var t,r;null===(t=o.formApi)||void 0===t||t.reset(),null===(r=o.formApi)||void 0===r||r.setValues({single:(0,v.Z)((0,v.Z)({},e.formState),e.sequenceSettings)})},saveSingleFormState:function(){var t,r=e.selectedSticker;if(r){var n=e.makeInitFormState((0,v.Z)((0,v.Z)((0,v.Z)({},null===(t=o.formApi)||void 0===t?void 0:t.getValue("single")),r.sequenceSettings),{},{sequenceSettingsApplyToAll:!1}));e.updateFormState(r,n)}},saveSequenceSettingsForSingle:function(){var t,n=e.makeInitFormState((0,v.Z)({},null===(t=o.formApi)||void 0===t?void 0:t.getValue("single"))),i=n.fps,c=n.loop,s=n.sequenceSettingsApplyToAll,a={fps:i,loop:c};o.importServ.updateSequenceSettings({newSettings:a,isApplyToAll:s}),r.sendSaveSequenceSettingsLog({collection_detail:"collection_material",sequenceSettings:{fps:i,loop:c,sequenceSettingsApplyToAll:s}})},saveSequenceSettingsForCollection:function(){var e,t=K((0,v.Z)({},null===(e=o.formApi)||void 0===e?void 0:e.getValue("collection"))),n={fps:t.fps,loop:t.loop};o.importServ.updateSequenceSettings({newSettings:n,isApplyToAll:!0}),r.sendSaveSequenceSettingsLog({collection_detail:"collection_all",sequenceSettings:(0,v.Z)((0,v.Z)({},t),{},{sequenceSettingsApplyToAll:!0})})},get needConfirmModalOnClose(){return"mainForm"===o.mainFormLayout||e.stickers.length>0},get isReadyToPublish(){var t=e.stickers.length;return Boolean(t>=Z.r$&&t<=Z.qb&&o.collection.isInfoComplete&&e.isReadyToPublish&&!o.isPublishSucceeded)},get uploadStats(){var t=e.uploadStats,r=0,n=0,i=0,c=o.collection,s=c.cover,a=c.exampleImages;return[s].concat((0,m.Z)(a)).forEach((function(e){e.isUploadFailed?i+=1:e.uri?n+=1:r+=1})),{pending:t.pending+r,succeeded:t.succeeded+n,failed:t.failed+i}},collectLogData:function(){var t=e.collectLogData(),r=o.collection,n=o.stickersForOnlineImageEditorStats,i=o.uploadStats,c=r.cover,s=r.exampleImages,a={isInfoComplete:r.isInfoComplete,stickersCount:t.length,stickersReadyToPublish:e.isReadyToPublish,stickersForOnlineImageEditorStats:n,uploadStats:i,stickers:t,cover:(0,S.Z)(c,["id","uri","needImport","isUploadFailed"]),exampleImages:s.map((function(e){return(0,S.Z)(e,["id","uri","isUploadFailed"])}))};(0,X.c6)("[CollectionStore] collectLogData",a)},get isAllUploaded(){var e=o.uploadStats,t=e.pending,r=e.failed;return!t&&!r},isAllUploadedWatcher:null,isPromptingConfirmToCancel:!1,handlePromptConfirmToCancel:function(e){return(0,g.Z)((0,f.Z)().mark((function t(){var r;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o.isPromptingConfirmToCancel=!0,t.next=3,e;case 3:r=t.sent,(0,_.z)((function(){r&&o.isAllUploadedWatcher.stop(),o.isPromptingConfirmToCancel=!1}));case 5:case"end":return t.stop()}}),t)})))()},uploadAndPublish:function(e){return(0,g.Z)((0,f.Z)().mark((function t(){return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.sendPageActionLog({action:"publish"}),o.isAllUploaded){t.next=7;break}return t.next=4,o.retryUpload();case 4:return null==e||e.show(),t.next=7,o.isAllUploadedWatcher.start();case 7:return t.prev=7,t.next=10,o.publish();case 10:return t.prev=10,null==e||e.hide(),t.finish(10);case 13:case"end":return t.stop()}}),t,null,[[7,,10,13]])})))()},isPublishing:!1,isPublishSucceeded:!1,publish:function(){return(0,g.Z)((0,f.Z)().mark((function e(){return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.isPublishing=!0,e.prev=1,e.next=4,o.publishImpl();case 4:e.next=12;break;case 6:return e.prev=6,e.t0=e.catch(1),h.FN.error(x.oc.t("pc_sticker_release_failed_retry_web")),(0,_.z)((function(){o.isPublishing=!1})),(0,X.RF)("[CollectionStore] publish failed",e.t0),e.abrupt("return");case 12:(0,_.z)((function(){o.isPublishing=!1,o.isPublishSucceeded=!0})),h.FN.success(x.oc.t("pc_sticker_release_successful_web")),(0,A.ZM)({effect_type:R.qG.StickerCollection}),(0,X.c6)("[CollectionStore] publish success"),setTimeout(A.Nt,1e3);case 17:case"end":return e.stop()}}),e,null,[[1,6]])})))()},publishImpl:function(){return(0,g.Z)((0,f.Z)().mark((function t(){var n,i,c,s,a,l,u,d,p,g,v,S,h,_,k,x;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o.isCollectionCoverCardSelected?o.saveCollectionFormState():o.saveSingleFormState(),n=o.collection,i=n.cover,c=n.exampleImages,s=n.formState,a=s.title,l=s.description,u=s.tags,d=s.isVip,p=s.isBusiness,g=s.isOriginal,v={effect_type:R.qG.StickerCollection,is_vip:d,common_data:{title:a,description:l,icon:{image_uri:i.uri},source:j.r0.UserPostPcCollection,tags:(0,m.Z)(u),is_business:p,is_original:g,web_extra:JSON.stringify({tab_detail_images:c.map((function(e){return e.uri}))})}},S=e.makePublishItemList({is_vip:v.is_vip,is_business:p,is_original:g,sourceForSimple:j.r0.UserPostPcCollection,sourceForSequence:j.r0.UserPostPcSequenceCollection,onResult:function(e,t){return(0,J.gd)({logPrefix:"[CollectionStore] ",sticker:e,publishResult:t,importServ:o.importServ,sendLogServ:o.sendLogServ})}}),(0,X.c6)("[CollectionStore] stickers publish start",{ids:S.map((function(e){return e.id}))}),t.next=9,o.pubServ.batchPublish(S);case 9:return h=t.sent,_=h.map((function(e){return e.resource_id})),v.collection_info={resource_id_list:_},(0,X.c6)("[CollectionStore] collection publish start",{resourceIdList:_}),t.next=15,o.pubServ.publish({id:n.id,req:v,onResult:function(e){var t=e.req,i=e.error,o=e.errorText,c=e.time,s=e.resourceId;r.sendStickerPublishStatusLog({error:o,time:c,collectionParams:{collection:n,collectionReqItem:t}}),i?(0,X.RF)("[CollectionStore] collection publish failed",i):(0,X.c6)("[CollectionStore] collection publish success",{resourceId:s})}});case 15:return k=t.sent,x=k.resource_id,(0,X.c6)("[CollectionStore] collection publish done",{resourceId:x}),t.next=20,o.pubServ.pollUntilAllInEffectList({ids:[x],types:[R.qG.StickerCollection]});case 20:(0,X.c6)("[SingleStore] poll done");case 21:case"end":return t.stop()}}),t)})))()},sendUploadProgressModalShowErrorLog:function(){var t=o.collection,n=e.stickers.filter((function(e){return e.isUploadFailed})).map((function(e){return{collection_detail:"collection_material",error_report:o.importServ.getFileStats(e.id).uploadError}}));t.cover.id&&t.cover.isUploadFailed&&n.push({collection_detail:"collection_cover",error_report:o.importServ.getFileStats(t.cover.id).uploadError}),t.exampleImages.forEach((function(e){e.isUploadFailed&&n.push({collection_detail:"collection_sample",error_report:o.importServ.getFileStats(e.id).uploadError})})),r.sendStickerPublishErrorLog(n)},retryUpload:function(){var e=this;return(0,g.Z)((0,f.Z)().mark((function t(){var r;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=[],[o.collection.cover].concat((0,m.Z)(o.collection.exampleImages)).forEach((function(e){e.isUploadFailed&&r.push(e.id)})),t.next=4,e.importServ.retryUpload(r);case 4:(0,_.z)((function(){[o.collection.cover].concat((0,m.Z)(o.collection.exampleImages)).forEach((function(e){r.includes(e.id)&&(e.isUploadFailed=!1)}))}));case 5:case"end":return t.stop()}}),t)})))()},retryTimesForOnlineImageEditor:0,retryUploadForOnlineImageEditor:function(){var e=o.getStickersForOnlineImageEditor(),t=e.pending,r=e.failed;0===t.length&&r.length>0&&(o.retryTimesForOnlineImageEditor+=1,o.retryUpload())},getStickersForOnlineImageEditor:function(){var t=[],r=[],n=[];return e.stickers.forEach((function(e){if(e.unmetRequirements.length>0)return!1;if(e.isSequence){if(e.isUploadFailed)return void n.push(e);if(e.largeImageUri)return void t.push(e)}else if(e.hasCheckedRequirements)return void t.push(e);r.push(e)})),{pending:r,ready:t,failed:n}},get stickersForOnlineImageEditorStats(){var e=o.getStickersForOnlineImageEditor(),t=e.pending,r=e.ready,n=e.failed;return{pending:t.length,ready:r.length,failed:n.length}},generateCollectionCoverWatcher:null,startCheckGenerateCollectionCover:function(){o.collection.cover.needImport=!1,o.generateCollectionCoverWatcher.start()},stopCheckGenerateCollectionCover:function(){o.generateCollectionCoverWatcher.stop()},generateCollectionCoverIfNeeded:function(){var t=o.getStickersForOnlineImageEditor(),r=t.ready,n=t.failed,i=new Set(n.map((function(e){return e.id}))),c=new Set(r.map((function(e){return e.id}))),s=e.stickers.slice(0,Z.GR);return s.length!==Z.GR||s.some((function(e){return e.unmetRequirements.length>0||i.has(e.id)}))?(o.collection.cover.needImport=!0,!0):!!s.every((function(e){return c.has(e.id)}))&&(o.generateCollectionCover(s),!0)},generateCollectionCover:function(e){return(0,g.Z)((0,f.Z)().mark((function t(){var r;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.importServ.generateCollectionCover({collectionId:o.collection.id,stickers:e});case 2:if(r=t.sent,!o.collection.cover.id){t.next=6;break}return(0,X.c6)("[CollectionStore] generateCollectionCover ignored",{coverId:o.collection.cover.id}),t.abrupt("return");case 6:if(!r){t.next=9;break}return o.replaceCover(r,"online_generated"),t.abrupt("return");case 9:(0,_.z)((function(){o.collection.cover.needImport=!0})),(0,X.RF)("[CollectionStore] generateCollectionCover failed");case 11:case"end":return t.stop()}}),t)})))()},replaceCover:function(e,t){var r=this;o.collection.cover.id&&o.importServ.removeFile(o.collection.cover.id),o.stopCheckGenerateCollectionCover(),o.collection.cover={id:e,uri:"",url:"",needImport:!1,isUploadFailed:!1,generatedFrom:t},o.importServ.recordFileUploadStart(e),o.importServ.registerThumbnailEvent(e,(function(t){o.collection.cover.id===e?t.base64?(0,_.z)((function(){o.collection.cover.url=(0,y.F2)(t.base64)})):(0,X.RF)("[CollectionStore] cover thumbnail failed ".concat(e)):(0,X.c6)("[CollectionStore] cover thumbnail ignored ".concat(e),{coverId:o.collection.cover.id})})),o.importServ.registerUploadEvent(e,(function(t){if(o.collection.cover.id===e){var n=o.collection.cover,i=t.uri;(0,_.z)((function(){if(i)n.uri=i,o.importServ.recordFileUploadEnd(e),(0,X.c6)("[CollectionStore] cover upload success ".concat(e),{uri:i});else{n.isUploadFailed=!0;var r=t.error||"unknown";o.importServ.recordFileUploadEnd(e,r),(0,X.RF)("[CollectionStore] cover upload failed ".concat(e),null,{error:r})}})),r.sendLogServ.sendCollectionUploadStatusLog({cover:n,stats:o.importServ.getFileStats(e)})}else(0,X.c6)("[CollectionStore] cover upload ignored ".concat(e),{coverId:o.collection.cover.id})}))},replaceExample:function(e,t){var r=this,n=o.collection.exampleImages[0];null!=n&&n.id&&o.importServ.removeFile(null==n?void 0:n.id),o.collection.exampleImages=[{id:e,uri:"",url:"",isUploadFailed:!1,generatedFrom:t}],o.importServ.recordFileUploadStart(e),o.importServ.registerThumbnailEvent(e,(function(t){var r=o.collection.exampleImages.find((function(t){return t.id===e}));r?t.base64?(0,_.z)((function(){r.url=(0,y.F2)(t.base64)})):(0,X.RF)("[CollectionStore] exampleImage thumbnail failed ".concat(e)):(0,X.c6)("[CollectionStore] exampleImage thumbnail ignored ".concat(e))})),o.importServ.registerUploadEvent(e,(function(t){var n=o.collection.exampleImages.find((function(t){return t.id===e}));n?((0,_.z)((function(){var r=t.uri;if(r)n.uri=r,o.importServ.recordFileUploadEnd(e),(0,X.c6)("[CollectionStore] exampleImage upload success ".concat(e),{uri:r});else{n.isUploadFailed=!0;var i=t.error||"unknown";o.importServ.recordFileUploadEnd(e,i),(0,X.RF)("[CollectionStore] exampleImage upload failed ".concat(e),null,{error:i})}})),r.sendLogServ.sendCollectionUploadStatusLog({exampleImage:n,stats:o.importServ.getFileStats(e)})):(0,X.c6)("[CollectionStore] exampleImage upload ignored ".concat(e))}))},openCoverImageEditor:function(){return(0,g.Z)((0,f.Z)().mark((function e(){var t,n;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.sendPageActionLog({action:"cover_generate_from_online"}),e.next=3,o.refreshUploadConfigsIfNeeded("openCoverImageEditor");case 3:return t=o.getStickersForOnlineImageEditor().ready,e.next=6,o.importServ.openStickerOnlineImageEditor((0,v.Z)((0,v.Z)({},Z.J),{},{collectionId:o.collection.id,type:"CoverImage",stickers:t}));case 6:(n=e.sent)&&o.replaceCover(n,"online_generated");case 8:case"end":return e.stop()}}),e)})))()},localUploadCover:function(){var e=this;return(0,g.Z)((0,f.Z)().mark((function t(){var n,i;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.sendPageActionLog({action:"cover_upload_from_local"}),t.next=3,o.refreshUploadConfigsIfNeeded("localUploadCover");case 3:return t.next=5,o.importServ.localUploadImage((0,v.Z)({},Z.J));case 5:return n=t.sent,t.next=8,e.checkLocalUploadRequirements({image:n,collection_detail:"collection_cover",requirements:Z.J,i18nKey:{minImageSize:"pc_collection_cover_size_{X}x{X}px_web"}});case 8:(i=t.sent)&&o.replaceCover(i.id,"local_uploaded");case 10:case"end":return t.stop()}}),t)})))()},openExampleImageEditor:function(){return(0,g.Z)((0,f.Z)().mark((function e(){var t,r;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.refreshUploadConfigsIfNeeded("openExampleImageEditor");case 2:return t=o.getStickersForOnlineImageEditor().ready,e.next=5,o.importServ.openStickerOnlineImageEditor((0,v.Z)((0,v.Z)({},Z.Em),{},{collectionId:o.collection.id,type:"ExampleImage",stickers:t}));case 5:(r=e.sent)&&o.replaceExample(r,"online_generated");case 7:case"end":return e.stop()}}),e)})))()},removeExample:function(){var e=o.collection.exampleImages[0];null!=e&&e.id&&o.importServ.removeFile(null==e?void 0:e.id),o.collection.exampleImages=[]},localUploadExample:function(){var e=this;return(0,g.Z)((0,f.Z)().mark((function t(){var r,n;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.refreshUploadConfigsIfNeeded("localUploadExample");case 2:return t.next=4,o.importServ.localUploadImage((0,v.Z)({},Z.Em));case 4:return r=t.sent,t.next=7,e.checkLocalUploadRequirements({image:r,collection_detail:"collection_sample",requirements:Z.Em,i18nKey:{minImageSize:"pc_sample_smallest_size_{X}x{X}px_web"}});case 7:(n=t.sent)&&o.replaceExample(n.id,"local_uploaded");case 9:case"end":return t.stop()}}),t)})))()},checkLocalUploadRequirements:function(e){return(0,g.Z)((0,f.Z)().mark((function t(){var n,i,o,c,s,a,l;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.image,i=e.requirements,o=e.i18nKey,c=e.collection_detail,n){t.next=3;break}return t.abrupt("return",null);case 3:if(s=n.width,a=n.height,l=i.minImageSize,!(s<l||a<l)){t.next=10;break}return z.Z.warn({mainText:x.oc.t("pc_stickers_release_failed_web"),subText:x.oc.t(o.minImageSize,{X:l}),confirmBtnText:x.oc.t("pc_stickers_release_confirm_web")}),r.sendStickerImportErrorLog({collection_detail:c,error_report:"width or height < ".concat(l)}),(0,X.c6)("[CollectionStore] ".concat(c," checkLocalUploadRequirements not passed: minImageSize"),{width:s,height:a,minImageSize:l}),t.abrupt("return",null);case 10:return t.abrupt("return",n);case 11:case"end":return t.stop()}}),t)})))()},destroy:function(){o.stopCheckGenerateCollectionCover()}}}),{formApi:!1,isAllUploadedWatcher:!1,generateCollectionCoverWatcher:!1});return o.isAllUploadedWatcher=(0,U.e)({watch:function(){return o.isAllUploaded&&!o.isPromptingConfirmToCancel}}),o.generateCollectionCoverWatcher=(0,U.e)({watch:function(){return o.generateCollectionCoverIfNeeded()}}),(0,J.LP)({watch:function(){o.uploadStats,o.isReadyToPublish},collect:o.collectLogData}),(0,n.useEffect)((function(){window.store=o;var e=(0,_.EH)((function(){var e=o.needConfirmModalOnClose;(0,A.c0)({isNeed:e})}));return o.importServ.uploadConfigsCache.updateCache(),function(){t.destroy(),o.importServ.destroy(),e()}}),[]),o}(),t=(0,o.$)().t,r=e.importServ.stickerListStore.selectedSticker;return(0,Zt.F)({title:t("pc_stickers_release_ing_web"),pid:"sticker-publish-collection"}),(0,$.t9)(e.sendLogServ),(0,de.jsxs)(Q.Provider,{value:e,children:[(0,de.jsxs)("div",{className:yt,children:[(0,de.jsxs)("div",{className:Ut,children:[(0,de.jsx)(c.n,{className:Nt,sticker:r}),(0,de.jsx)(bt,{className:jt})]}),(0,de.jsx)(Ft,{className:qt})]}),!1]})})),Pt=function(){return(0,n.useEffect)((function(){E.K.setEntryPage("sticker-entry")}),[]),(0,de.jsx)(Et,{})}},4365:function(e,t,r){r.d(t,{BI:function(){return b},Em:function(){return v},GR:function(){return _},J:function(){return g},N7:function(){return d},Q0:function(){return p},R8:function(){return l},S8:function(){return k},Us:function(){return x},fD:function(){return u},mr:function(){return f},pM:function(){return C},qb:function(){return h},r$:function(){return S},rg:function(){return m}});var n,i,o,c,s=r(58216),a=r(21571),l=function(e){return e.Static="static",e.GIF="gif",e.Sequence="sequence",e}({}),u=function(e){return e.Format="format",e.MinImageSize="minImageSize",e.RecommendFileSize="RecommendFileSize",e.SequenceNumber="SequenceNumber",e}({}),d={fps:16,loop:!0},p={maxCount:49,minCount:2,minImageSize:360,maxImageSize:1080,maxFileSize:20971520},m={accept:".png,.jpg,.jpeg,.gif",multiple:!0,enableImportSequence:!0,thumbnailSize:200,minImageSize:360,maxImageSize:800,maxFileSize:20971520},f={fps:16,loop:!0,gen_size:0,gif_gen_opts:[{bg_color:"#242424",width:200,height:200,padding:0},{bg_color:"",width:0,height:0,padding:0}]},g={accept:".png,.gif",minImageSize:320,maxImageSize:1e3,maxFileSize:20971520},v={accept:".png,.gif",minImageSize:320,maxImageSize:1250,maxFileSize:5242880},S=20,h=80,_=4,k=40,x=52,C=15,b=(c={},(0,s.Z)(c,l.Static,(n={},(0,s.Z)(n,u.Format,a.oc.t("pc_stickers_release_format_web")),(0,s.Z)(n,u.MinImageSize,a.oc.t("pc_stickers_release_size_min_web")),(0,s.Z)(n,u.RecommendFileSize,a.oc.t("pc_stickers_release_recommend_web")),n)),(0,s.Z)(c,l.GIF,(i={},(0,s.Z)(i,u.Format,a.oc.t("pc_stickers_release_format_gif_web")),(0,s.Z)(i,u.MinImageSize,a.oc.t("pc_stickers_release_size_min_web")),(0,s.Z)(i,u.RecommendFileSize,a.oc.t("pc_stickers_release_recommend_web")),i)),(0,s.Z)(c,l.Sequence,(o={},(0,s.Z)(o,u.Format,a.oc.t("pc_stickers_release_png_groups_web_web")),(0,s.Z)(o,u.MinImageSize,a.oc.t("pc_stickers_release_reccomend_size_web")),(0,s.Z)(o,u.SequenceNumber,a.oc.t("pc_stickers_release_amount_web")),(0,s.Z)(o,u.RecommendFileSize,a.oc.t("pc_stickers_release_recommend_web")),o)),c)},78367:function(e,t,r){r.d(t,{B3:function(){return g},Nf:function(){return v},WQ:function(){return h},w3:function(){return S}});var n=r(17576),i=r(49919),o=r(3972),c=r(29391),s=r(50959),a=r(49765),l=r(4365),u=r(87367),d=r(24738),p=r(67819),m=r(18672),f=["title","isInfoComplete","formState","path","isSequence"];function g(e){return e.coverSrc||e.firstFrameCoverSrc}function v(e){return e.isSequence&&Boolean(e.isSequenceSettingsUpdating||e.firstFrameCoverSrc&&!e.coverSrc)}function S(e){return e.isSequence||"gif"===(0,m.lm)(e.path)}function h(){var e=(0,a.fv)((function(){return{stickers:[],scrollAreaRef:(0,s.createRef)(),get hasStickers(){return this.stickers.length>0},selectedId:null,get selectedSticker(){return e.selectedId?e.getSticker(e.selectedId):null},setScrollAreaRef:function(t){e.scrollAreaRef=t},addStickers:function(t){var r;(r=e.stickers).push.apply(r,(0,o.Z)(t))},getSticker:function(t){var r;return null!==(r=e.stickers.find((function(e){return e.id===t})))&&void 0!==r?r:null},selectSticker:function(t){e.selectedId=t,e.selectedSticker&&(e.selectedSticker.hasEverSelected=!0)},updateThumbnailSrc:function(e,t){e.isSequence?e.firstFrameCoverSrc=t:e.coverSrc=t},updateUploadedData:function(e,t,r){if(e.uri=t,!e.isSequence)return e.coverUri=t,void(e.largeImageUri=t);if(r){var n=r.gifCover,i=r.gifLargeImage,o=r.stickerPackage;e.coverUri=n.uri,e.coverSrc=n.blobUrl,e.largeImageUri=i.uri,e.stickerPackage=o,e.isSequenceSettingsUpdating=!1}},updateUnmetRequirements:function(e,t){e.unmetRequirements=t,e.hasCheckedRequirements=!0},setUploadFailed:function(e){e.isUploadFailed=!0},get isAllStickersThumbnailReady(){return e.stickers.length>0&&e.stickers.every((function(e){return g(e)}))},applyForTags:function(t){e.stickers.forEach((function(e){e.formState.tags=t}))},makeInitFormState:function(e){return(0,i.Z)((0,i.Z)({title:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:!1},l.N7),{},{sequenceSettingsApplyToAll:!1},e)},updateFormState:function(e,t){Object.assign(e.formState,t)},makeInitSticker:function(t){t.title,t.isInfoComplete,t.formState;var r=t.path,o=void 0===r?"":r,c=t.isSequence,s=void 0!==c&&c,a=(0,n.Z)(t,f),u=function(e,t){var r=(0,m.lm)(e);if(t)return l.R8.Sequence;if("gif"===r)return l.R8.GIF;if(["png","jpg","jpeg"].includes(r))return l.R8.Static;throw new Error("Unsupported suffix ".concat(r))}(o,s),d=function(e,t){var r=e.split(/[\\/]/g).pop(),n=t?r:r.replace(/\.\w+?$/g,"");return(0,p.a)(n,l.S8)}(o,s);return(0,i.Z)({id:"",path:o,get title(){return this.formState.title},fileType:u,width:0,height:0,isSequence:s,firstFrameCoverSrc:"",coverSrc:"",uri:"",coverUri:"",largeImageUri:"",stickerPackage:{uri:"",md5:"",size:0},sequenceSettings:(0,i.Z)({fps:0,loop:!1},t.isSequence&&l.N7),hasEverSelected:!1,get isInfoComplete(){return Boolean(this.hasEverSelected&&this.title&&this.formState.tags.length>0)},unmetRequirements:[],hasCheckedRequirements:!1,isUploadFailed:!1,isSequenceSettingsUpdating:!1,formState:e.makeInitFormState({title:d})},a)},reimportSticker:function(t,r){var n=e.stickers.findIndex((function(e){return e.id===t}));-1!==n&&(e.stickers[n]=r)},startToRetryUploadStickers:function(t){t.forEach((function(t){var r=e.getSticker(t);r&&(r.isUploadFailed=!1)}))},startToUpdateSequenceSettings:function(e,t){e.forEach((function(e){e.sequenceSettings=t,e.largeImageUri&&(e.largeImageUri="",e.coverUri="",e.stickerPackage={uri:"",md5:"",size:0},e.isSequenceSettingsUpdating=!0)}))},removeSticker:function(t){e.stickers=e.stickers.filter((function(e){return e.id!==t.id}))},dragInsert:function(t,r){var n,i=e.stickers.splice(t,1),c=t>r?r+1:r;(n=e.stickers).splice.apply(n,[c,0].concat((0,o.Z)(i)))},get isReadyToPublish(){return e.stickers.every((function(e){return e.hasCheckedRequirements&&0===e.unmetRequirements.length&&e.isInfoComplete}))},get uploadStats(){var t=0,r=0,n=0;return e.stickers.forEach((function(e){e.isUploadFailed?r+=1:(e.isSequence?e.largeImageUri:e.uri)?t+=1:n+=1})),{pending:n,succeeded:t,failed:r}},collectLogData:function(){return e.stickers.map((function(e){return(0,i.Z)((0,i.Z)({},(0,c.Z)(e,["id","isSequence","isInfoComplete","hasEverSelected","isUploadFailed","uri"])),e.isSequence&&(0,i.Z)({isSequenceUpdating:e.isSequenceSettingsUpdating,largeImageUri:e.largeImageUri},e.sequenceSettings))}))},makePublishItemList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.stickers.map((function(e){var r=e.id,n=e.isSequence,c=e.formState,s=e.stickerPackage,a=t.is_vip,l=void 0===a?Boolean(c.isVip):a,p=t.is_business,m=void 0===p?c.isBusiness:p,f=t.is_original,g=void 0===f?c.isOriginal:f,v=t.sourceForSimple,h=void 0===v?u.r0.UserPostPc:v,_=t.sourceForSequence,k=void 0===_?u.r0.UserPostPcSequence:_,x=t.onResult,C=n?k:h;return{id:r,req:{effect_type:d.qG.Sticker,is_vip:l,common_data:(0,i.Z)({title:c.title,description:c.title,icon:{image_uri:e.coverUri},sdk_version:"1.0.0",source:C,tags:(0,o.Z)(c.tags),is_original:g,is_business:m,web_extra:""},n&&{file:{file_uri:s.uri,file_md5:s.md5,size:s.size}}),sticker:{large_image:{image_uri:e.largeImageUri},sticker_type:S(e)?u.Ic.Dynamic:u.Ic.Static,no_multi_sticker:!1,package_size:0}},onResult:function(t){return null==x?void 0:x(e,t)}}}))}}}));return e}},18672:function(e,t,r){r.d(t,{F2:function(){return s},J9:function(){return c},lm:function(){return a}});var n=r(43941),i=r(66097),o=(r(96706),function(e){return URL.createObjectURL(e)}),c=function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r,i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return r=e.sent,e.next=5,r.blob();case 5:return i=e.sent,e.abrupt("return",o(i));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=function(e){return"data:".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",";base64,").concat(e)};var a=function(e){return e.toLowerCase().split(".").pop()}},86094:function(e,t,r){r.d(t,{O1:function(){return i},xB:function(){return o}});var n=r(29922);r(38023);var i=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split("").reduce((function(e,t){return e+(/^[\u4e00-\u9fa5]$/.test(t)?2:1)}),0)};function o(e){var t=e.len,r=(e.i18n.language||"").split("-");return"zh"===(0,n.Z)(r,1)[0]?Math.floor(t/2):t}}}]);